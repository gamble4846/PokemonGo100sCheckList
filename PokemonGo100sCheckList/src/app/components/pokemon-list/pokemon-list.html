<div class="pokemon-list-container">
  <div class="header">
    <h1>Pok√©mon GO Pok√©dex</h1>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Search by name or number..." 
        [value]="searchTerm()"
        (input)="onSearchChange($any($event.target).value)"
        class="search-input"
      />
    </div>
    @if (!isAuthenticated()) {
      <div class="auth-notice">
        <span>üîí Sign in to save your progress</span>
      </div>
    }
    @if (isAuthenticated()) {
      <div class="counts-section">
        <div class="count-item">
          <span class="count-label">100IV </span>
          <span class="count-value">{{ count100iv() }}</span>
        </div>
        <div class="count-item">
          <span class="count-label">Shiny 100IV </span>
          <span class="count-value">{{ countShiny100iv() }}</span>
        </div>
        <div class="count-item pending">
          <span class="count-label">Pending 100IV </span>
          <span class="count-value">{{ pending100iv() }}</span>
        </div>
        <div class="count-item pending">
          <span class="count-label">Pending Shiny 100IV </span>
          <span class="count-value">{{ pendingShiny100iv() }}</span>
        </div>
      </div>
    }
  </div>

  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading Pok√©mon...</p>
    </div>
  } @else {
    <div class="families-container">
      @for (family of filteredFamilies(); track family.familyId) {
        <div class="family-row">
          <div class="family-header">
            <span class="family-name">{{ family.familyName }} Family</span>
            <span class="family-count">({{ family.pokemon.length }} Pok√©mon)</span>
          </div>
          <div class="family-pokemon">
            @for (pokemon of family.pokemon; track pokemon.id) {
              <a [routerLink]="['/pokemon', pokemon.id]" class="pokemon-card-inline">
                <div class="pokemon-portrait-container">
                  <div class="pokemon-number-badge">#{{ pokemon.id }}</div>
                  <div class="pokemon-image-circle">
                    @if (isImageLoading(pokemon.id)) {
                      <img src="/Images/pokemon.png" alt="Loading..." class="pokeball-spinner" />
                    }
                    <img 
                      [src]="pokemon.sprite" 
                      [alt]="pokemon.name" 
                      loading="lazy"
                      (loadstart)="onImageStartLoad(pokemon.id)"
                      (load)="onImageLoad(pokemon.id)"
                      (error)="onImageError(pokemon.id)"
                      [class.hidden]="isImageLoading(pokemon.id)"
                    />
                  </div>
                </div>
                <div class="pokemon-name">{{ pokemon.name }}</div>
                <div class="pokemon-checkboxes">
                  <label class="checkbox-label" [class.disabled]="!isAuthenticated()">
                    <input 
                      type="checkbox" 
                      [checked]="isChecked100iv(pokemon.id)"
                      [disabled]="!isAuthenticated()"
                      (change)="toggle100iv(pokemon.id, $event)"
                      (click)="$event.stopPropagation()"
                    />
                    <span>100IV</span>
                  </label>
                  <label class="checkbox-label" [class.disabled]="!isAuthenticated()">
                    <input 
                      type="checkbox" 
                      [checked]="isCheckedShiny100iv(pokemon.id)"
                      [disabled]="!isAuthenticated()"
                      (change)="toggleShiny100iv(pokemon.id, $event)"
                      (click)="$event.stopPropagation()"
                    />
                    <span>Shiny 100IV</span>
                  </label>
                </div>
              </a>
            }
          </div>
        </div>
      }
    </div>

    @if (filteredFamilies().length === 0) {
      <div class="no-results">
        <p>No Pok√©mon found matching your criteria.</p>
      </div>
    }
  }
</div>